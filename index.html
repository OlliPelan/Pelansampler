<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
<title>Pelan Sampler + Sequencer</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Pelan Sampler">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1f1f1f">

<style>
  /* === existing sampler styles unchanged === */
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html,body { margin:0; padding:10px; background:#1f1f1f; color:#fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    user-select:none; -webkit-user-select:none; touch-action: manipulation; overscroll-behavior: none; height:100dvh }
  .pad-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:14px;}
  .pad{aspect-ratio:1;min-height:100px;background:#4d4d4d;border:2px solid #3b3b3b;border-radius:12px;
    display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;}
  .pad.active{background:#e67e22;}
  .pad.has-sample{background:#2e9b60;}
  .pad.selected{border-color:#f1c40f;}
  .pad-number{font-weight:800;font-size:18px;}
  .pad-name{font-size:12px;margin-top:4px;overflow:hidden;white-space:nowrap;max-width:90%;}

  button{padding:10px 14px;border:none;border-radius:8px;font-weight:700;cursor:pointer;margin:4px;background:#444;color:#fff}

  .controls{background:#2b2b2b;padding:10px;border-radius:10px;margin-top:8px;}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
  .group{display:flex;align-items:center;gap:8px;flex:1 1 180px;}
  .group label{width:86px;font-size:13px;color:#ddd;}
  .group input[type=range]{flex:1;-webkit-appearance:none;height:6px;border-radius:3px;background:#555;outline:none;}
  .group input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#f1c40f;cursor:pointer;}
  .group span{width:48px;text-align:right;font-size:12px;opacity:.85;}

  #status{margin-top:8px;font-size:14px;opacity:.9;}

  /* === Sequencer styles === */
  .sequencer {margin-top:24px; background:#2b2b2b; padding:12px; border-radius:12px;}
  .transport {display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;}
  .transport button{background:#444;}
  .tempo-control,.swing-control{display:flex;align-items:center;gap:6px;}
  .sequencer-grid{margin-top:10px;overflow-x:auto;}
  .track-row{display:grid;grid-template-columns:90px repeat(8,1fr);gap:6px;margin-bottom:6px;}
  .track-label{font-size:12px;text-align:center;padding:4px;background:#444;border-radius:6px;}
  .step-btn{aspect-ratio:1;background:#4d4d4d;border:2px solid #3b3b3b;border-radius:6px;cursor:pointer;transition:.15s;}
  .step-btn.active{background:#e67e22;border-color:#f39c12;}
  .step-btn.current{border-color:#fff;}
</style>
</head>
<body>
<div id="versionLabel">Pelan Sampler v1.3.2</div>

<!-- Sampler Pads -->
<div class="pad-grid" id="padGrid"></div>

<!-- Sampler Buttons -->
<div>
  <button id="recordBtn">Record</button>
  <input type="file" id="fileInput" accept="audio/*" style="display:none;">
  <button id="loadBtn">Load</button>
  <button id="clearPad">Clear</button>
  <button id="muteGroup1Btn">Mute 1</button>
  <button id="muteGroup2Btn">Mute 2</button>
  <button id="muteGroup3Btn">Mute 3</button>
</div>

<!-- Sampler Controls -->
<div class="controls">… (unchanged controls markup) …</div>
<div id="status">Ready</div>

<!-- === Sequencer Section === -->
<div class="sequencer">
  <div class="transport">
    <button id="playBtn">Play</button>
    <button id="stopBtn">Stop</button>
    <button id="tapTempoBtn">Tap Tempo</button>
    <div class="tempo-control">
      <label>BPM:</label>
      <input type="number" id="tempoInput" value="120" min="60" max="200" style="width:70px">
    </div>
    <div class="swing-control">
      <label>Swing:</label>
      <input type="range" id="swingSlider" min="50" max="100" value="50">
      <span id="swingValue">50%</span>
    </div>
  </div>

  <div class="sequencer-grid" id="sequencerTracks"></div>
</div>

<!-- JS: Sampler (unchanged, as before) -->
<script>
/* ... existing Sampler class exactly as in your file ... */
</script>

<!-- JS: Sequencer -->
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const sampler = new Sampler(); // existing sampler
  
  const steps=8, tracks=9;
  const seq=[...Array(tracks)].map(()=>Array(steps).fill(false));
  let isPlaying=false, step=0, interval, tempo=120;

  const grid=document.getElementById('sequencerTracks');
  for(let t=0;t<tracks;t++){
    const row=document.createElement('div');
    row.className='track-row';
    const label=document.createElement('div');label.className='track-label';label.textContent='Pad '+(t+1);
    row.appendChild(label);
    for(let s=0;s<steps;s++){
      const btn=document.createElement('div');
      btn.className='step-btn';
      btn.dataset.t=t;btn.dataset.s=s;
      btn.onclick=()=>{seq[t][s]=!seq[t][s];btn.classList.toggle('active',seq[t][s]);};
      row.appendChild(btn);
    }
    grid.appendChild(row);
  }

  function updateStepVis(){
    document.querySelectorAll('.step-btn').forEach(b=>b.classList.remove('current'));
    document.querySelectorAll(`.step-btn[data-s="${step}"]`).forEach(b=>b.classList.add('current'));
  }

  function tick(){
    for(let t=0;t<tracks;t++) if(seq[t][step]) sampler.play(t+1);
    updateStepVis();
    step=(step+1)%steps;
  }

  function start(){
    if(isPlaying)return;isPlaying=true;
    const ms=(60/tempo/2)*1000; // 1/8th note resolution
    interval=setInterval(tick,ms);
  }
  function stop(){
    isPlaying=false;clearInterval(interval);step=0;updateStepVis();
  }

  document.getElementById('playBtn').onclick=()=>{isPlaying? (clearInterval(interval),isPlaying=false):(start());};
  document.getElementById('stopBtn').onclick=stop;
  document.getElementById('tempoInput').oninput=e=>{tempo=+e.target.value;if(isPlaying){clearInterval(interval);start();}};

  // Swing + Tap tempo UI updating (simplified)
  document.getElementById('swingSlider').oninput=e=>{
    document.getElementById('swingValue').textContent=e.target.value+'%';
  };
});
</script>
</body>
</html>